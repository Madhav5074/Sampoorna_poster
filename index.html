<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sampoorna 2.0 Poster Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 550px;
            margin: auto;
        }
        canvas {
            border: 2px solid #e2e8f0;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: auto;
            max-width: 1080px;
        }
        #posterCanvas, #downloadBtn, #loadingIndicator {
            display: none;
        }
        .version-number {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            font-size: 0.875rem;
            color: #9ca3af;
        }
        .copyright-text {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            font-size: 0.875rem;
            color: #9ca3af;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0c4a6e;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

    <div class="container bg-white p-10 rounded-3xl shadow-2xl flex flex-col gap-8">

        <form id="posterForm" class="flex flex-col gap-6">
            <h1 class="text-4xl font-extrabold text-center text-blue-900 mb-2">Sampoorna 2.0 Poster</h1>

            <div>
                <label for="employeePhoto" class="block text-sm font-semibold text-gray-700 mb-2">Upload Employee Photo</label>
                <input type="file" id="employeePhoto" accept="image/*" required class="w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-blue-50 file:text-blue-700
                    hover:file:bg-blue-100 cursor-pointer">
            </div>
            
            <div>
                <label for="employeeName" class="block text-sm font-semibold text-gray-700 mb-1">Employee Name</label>
                <input type="text" id="employeeName" placeholder="Enter Employee Name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="branch" class="block text-sm font-semibold text-gray-700 mb-1">Branch</label>
                <input type="text" id="branch" placeholder="Enter Branch" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="region" class="block text-sm font-semibold text-gray-700 mb-1">Region</label>
                <input type="text" id="region" placeholder="Enter Region" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="premium" class="block text-sm font-semibold text-gray-700 mb-1">Premium Amount</label>
                <input type="tel" id="premium" placeholder="Enter Premium Amount" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="nop" class="block text-sm font-semibold text-gray-700 mb-1">NOP (Number of Policies)</label>
                <input type="number" id="nop" placeholder="Enter NOP" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <button type="submit" id="generateBtn" class="bg-gradient-to-r from-blue-600 to-blue-800 text-white font-bold py-3 rounded-lg shadow-lg hover:from-blue-700 hover:to-blue-900 transition duration-300 transform hover:scale-105">Generate Poster</button>
        </form>

        <div id="loadingIndicator" class="flex flex-col items-center gap-4">
            <div class="spinner"></div>
            <p class="text-gray-700 font-semibold">Generating...</p>
        </div>

        <div id="posterContainer" class="flex flex-col items-center gap-6">
            <canvas id="posterCanvas" width="1080" height="1920"></canvas>
            <button id="downloadBtn" class="bg-gradient-to-r from-green-600 to-green-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:from-green-700 hover:to-green-900 transition duration-300 transform hover:scale-105">Download Poster</button>
        </div>
        
    </div>
    
    <div class="version-number">
        Version 3.0 - Sampoorna
    </div>
    <div class="copyright-text">
        Copyright © MADHAV KALRA
    </div>

    <script>
        const posterForm = document.getElementById('posterForm');
        const posterCanvas = document.getElementById('posterCanvas');
        const ctx = posterCanvas.getContext('2d');
        const downloadBtn = document.getElementById('downloadBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const premiumInput = document.getElementById('premium');

        // Path to your saved background image
        const templateUrl = './sampoorna-bg.png';

        premiumInput.addEventListener('input', function(event) {
            const value = this.value.replace(/[^0-9]/g, '');
            if (value) {
                this.value = `₹${Number(value).toLocaleString('en-IN')}`;
            } else {
                this.value = '';
            }
        });

        posterForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const employeePhotoInput = document.getElementById('employeePhoto');
            const file = employeePhotoInput.files[0];
            
            if (!file) {
                showMessage("Please upload an Employee photo.");
                return;
            }

            posterForm.style.display = 'none';
            loadingIndicator.style.display = 'flex';

            const data = {
                employeeName: document.getElementById('employeeName').value,
                branch: document.getElementById('branch').value,
                region: document.getElementById('region').value,
                premium: document.getElementById('premium').value,
                nop: document.getElementById('nop').value
            };

            const reader = new FileReader();
            reader.onload = function(event) {
                const employeeImage = new Image();
                employeeImage.src = event.target.result;

                const templateBg = new Image();
                templateBg.src = templateUrl;
                
                let loadedCount = 0;
                const totalToLoad = 2; // We are loading the employee image and the template
                
                const checkIfLoaded = () => {
                    loadedCount++;
                    if (loadedCount === totalToLoad) {
                        drawPoster(employeeImage, templateBg, data);
                        loadingIndicator.style.display = 'none';
                        posterCanvas.style.display = 'block';
                        downloadBtn.style.display = 'block';
                    }
                };

                employeeImage.onload = checkIfLoaded;
                templateBg.onload = checkIfLoaded;
                
                employeeImage.onerror = () => { console.error("Employee image failed to load."); checkIfLoaded(); };
                templateBg.onerror = () => { 
                    console.error("Template background failed to load. Make sure it's saved as 'sampoorna-bg.png'"); 
                    showMessage("Error: Could not load 'sampoorna-bg.png'. Make sure it is in the same folder as the HTML file.");
                    loadingIndicator.style.display = 'none';
                    posterForm.style.display = 'flex';
                };
            };
            reader.readAsDataURL(file);
        });

        function showMessage(message) {
            const container = document.querySelector('.container');
            let messageBox = document.getElementById('messageBox');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'messageBox';
                messageBox.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50';
                messageBox.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-xl text-center flex flex-col items-center gap-4">
                        <p class="text-lg font-semibold text-gray-800">${message}</p>
                        <button onclick="this.parentNode.parentNode.style.display='none'" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">OK</button>
                    </div>
                `;
                document.body.appendChild(messageBox);
            } else {
                messageBox.querySelector('p').textContent = message;
                messageBox.style.display = 'flex';
            }
        }

        function drawPoster(employeeImage, templateBg, data) {
            const canvasWidth = 1080;
            // 1920 maintains the aspect ratio of your 562x1000 image
            const canvasHeight = 1920; 
            posterCanvas.width = canvasWidth;
            posterCanvas.height = canvasHeight;

            // 1. Draw the background template
            ctx.drawImage(templateBg, 0, 0, canvasWidth, canvasHeight);

            // 2. Cover up the old placeholder text and circle
            // Coordinates are scaled from your 562x1000 image
            
            // Cover yellow text box
            ctx.fillStyle = '#fde88f'; // Color picked from your image
            const rectX = (250 / 562) * canvasWidth;
            const rectY = (650 / 1000) * canvasHeight;
            const rectW = (290 / 562) * canvasWidth;
            const rectH = (150 / 1000) * canvasHeight;
            ctx.fillRect(rectX, rectY, rectW, rectH);

            // Cover blue circle
            ctx.fillStyle = '#00aef0'; // Color picked from your image
            const circleX = (175 / 562) * canvasWidth;
            const circleY = (680 / 1000) * canvasHeight;
            const circleR = (65 / 562) * canvasWidth; // Radius scaled by width
            ctx.beginPath();
            ctx.arc(circleX, circleY, circleR, 0, Math.PI * 2);
            ctx.fill();

            // 3. Draw the new employee photo
            ctx.save();
            ctx.beginPath();
            ctx.arc(circleX, circleY, circleR, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();
            
            // Draw image centered in the circle
            let sourceX = 0;
            let sourceY = 0;
            let sourceSize = Math.min(employeeImage.width, employeeImage.height);
            if (employeeImage.width > employeeImage.height) {
                sourceX = (employeeImage.width - sourceSize) / 2;
            } else {
                sourceY = (employeeImage.height - sourceSize) / 2;
            }
            ctx.drawImage(
                employeeImage, 
                sourceX, sourceY, sourceSize, sourceSize, // Source (cropped square)
                circleX - circleR, circleY - circleR, circleR * 2, circleR * 2 // Destination (fills circle)
            );
            ctx.restore();

            // 4. Draw the new text
            ctx.fillStyle = '#0a304f'; // Dark blue text color from image
            ctx.font = 'bold 36px Inter, sans-serif';
            ctx.textAlign = 'left';

            let textX = rectX + 15; // Start text inside the yellow box
            let textY = rectY + 45;  // Start Y position
            const lineHeight = 50;  // Space between lines

            ctx.fillText(`Name: ${data.employeeName}`, textX, textY);
            textY += lineHeight;
            ctx.fillText(`Branch: ${data.branch}`, textX, textY);
            textY += lineHeight;
            ctx.fillText(`Region: ${data.region}`, textX, textY);
            textY += lineHeight;
            ctx.fillText(`Premium Amount: ${data.premium}`, textX, textY);
            textY += lineHeight;
            ctx.fillText(`NOP: ${data.nop}`, textX, textY);
        }

        downloadBtn.addEventListener('click', function() {
            const imageDataUrl = posterCanvas.toDataURL('image/png');
            const downloadLink = document.createElement('a');
            // Suggest a filename
            downloadLink.download = `sampoorna-poster.png`;
            downloadLink.href = imageDataUrl;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        });
    </script>
</body>
</html>
